<?xml version="1.0" encoding="UTF-8"?>
<project name="lenskit-eval">
  <!-- Set up the MovieLens 100K data. If data.movielens.100k is set, it is used
       as the location of the data; otherwise, it is downloaded from the GroupLens
       web site. -->

  <property name="mldata.zipfile" value="${project.build.directory}/ml-100k.zip"/>
  <property name="mldata.directory" value="${project.build.directory}/ml-100k"/>

  <target name="download-100k" unless="data.movielens.100k">
    <fail message="The `smoketest' integration tests make use of the MovieLens 100K data set
from GroupLens Research. Use of this data set is restricted to non-commercial
purposes and is only permitted in accordance with the license terms. To use
this data in LensKit's automated tests, set the `grouplens.mldata.acknowledge'
property to `yes' to indicate you acknowledge the usage license.  More
information is available at &lt;http://www.grouplens.org/node/73&gt;.">
      <condition>
        <not>
          <equals arg1="${grouplens.mldata.acknowledge}" arg2="yes"
                  trim="true" casesensitive="false"/>
        </not>
      </condition>
    </fail>
    <get src="http://www.grouplens.org/system/files/ml-100k.zip"
         dest="${mldata.zipfile}" skipexisting="true"/>
    <unzip src="${mldata.zipfile}" dest="${mldata.directory}"
           failOnEmptyArchive="true">
      <patternset>
        <include name="ml-100k/*"/>
      </patternset>
      <mapper type="flatten"/>
    </unzip>
  </target>

  <target name="copy-100k" if="data.movielens.100k">
    <fail message="${data.movielens.100k} does not seem to contain the ML100K data set.">
      <condition>
        <not>
          <available file="${data.movielens.100k}/u.data"/>
        </not>
      </condition>
    </fail>
    <mkdir dir="${mldata.directory}"/>
    <copy todir="${mldata.directory}">
      <fileset dir="${data.movielens.100k}">
        <include name="u.data"/>
      </fileset>
    </copy>
  </target>

  <target name="prepare-100k" depends="download-100k,copy-100k"/>
</project>
